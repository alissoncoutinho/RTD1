(function(n){"function"==typeof define&&define.amd?define(["jquery"],n):n(window.jQuery||window.Zepto)})(function(n){var r=function(t,i,r){var f=this,e,o,u;t=n(t);i="function"==typeof i?i(t.val(),void 0,t,r):i;u={getCaret:function(){try{var n,i=0,f=t.get(0),u=document.selection,r=f.selectionStart;return u&&!~navigator.appVersion.indexOf("MSIE 10")?(n=u.createRange(),n.moveStart("character",t.is("input")?-t.val().length:-t.text().length),i=n.text.length):(r||"0"===r)&&(i=r),i}catch(e){}},setCaret:function(n){try{if(t.is(":focus")){var i,r=t.get(0);r.setSelectionRange?r.setSelectionRange(n,n):r.createTextRange&&(i=r.createTextRange(),i.collapse(!0),i.moveEnd("character",n),i.moveStart("character",n),i.select())}}catch(u){}},events:function(){t.on("keydown.mask",function(){e=u.val()}).on("keyup.mask",u.behaviour).on("paste.mask drop.mask",function(){setTimeout(function(){t.keydown().keyup()},100)}).on("change.mask",function(){t.data("changed",!0)}).on("blur.mask",function(){e===t.val()||t.data("changed")||t.trigger("change");t.data("changed",!1)}).on("focusout.mask",function(){r.clearIfNotMatch&&!o.test(u.val())&&u.val("")})},getRegexMask:function(){for(var n=[],t,e,o,r,u=0;u<i.length;u++)(t=f.translation[i[u]])?(e=t.pattern.toString().replace(/.{1}$|^.{1}/g,""),o=t.optional,(t=t.recursive)?(n.push(i[u]),r={digit:i[u],pattern:e}):n.push(o||t?e+"?":e)):n.push("\\"+i[u]);return n=n.join(""),r&&(n=n.replace(RegExp("("+r.digit+"(.*"+r.digit+")?)"),"($1)?").replace(RegExp(r.digit,"g"),r.pattern)),RegExp(n)},destroyEvents:function(){t.off("keydown keyup paste drop change blur focusout DOMNodeInserted ".split(" ").join(".mask ")).removeData("changeCalled")},val:function(n){var i=t.is("input");return 0<arguments.length?i?t.val(n):t.text(n):i?t.val():t.text()},getMCharsBeforeCount:function(n,t){for(var u=0,r=0,e=i.length;r<e&&r<n;r++)f.translation[i.charAt(r)]||(n=t?n+1:n,u++);return u},caretPos:function(n,t,r,e){return f.translation[i.charAt(Math.min(n-1,i.length-1))]?Math.min(n+r-t-e,r):u.caretPos(n+1,t,r,e)},behaviour:function(t){var i;if(t=t||window.event,i=t.keyCode||t.which,-1===n.inArray(i,f.byPassKeys)){var r=u.getCaret(),s=u.val(),e=s.length,c=r<e,o=u.getMasked(),h=o.length,l=u.getMCharsBeforeCount(h-1)-u.getMCharsBeforeCount(e-1);return o!==s&&u.val(o),!c||65===i&&t.ctrlKey||(8!==i&&46!==i&&(r=u.caretPos(r,e,h,l)),u.setCaret(r)),u.callbacks(t)}},getMasked:function(n){var h=[],k=u.val(),t=0,c=i.length,o=0,v=k.length,e=1,y="push",l=-1,s,p;for(r.reverse?(y="unshift",e=-1,s=0,t=c-1,o=v-1,p=function(){return-1<t&&-1<o}):(s=c-1,p=function(){return t<c&&o<v});p();){var w=i.charAt(t),b=k.charAt(o),a=f.translation[w];a?(b.match(a.pattern)?(h[y](b),a.recursive&&(-1===l?l=t:t===s&&(t=l-e),s===l&&(t-=e)),t+=e):a.optional&&(t+=e,o-=e),o+=e):(n||h[y](w),b===w&&(o+=e),t+=e)}return n=i.charAt(s),c!==v+1||f.translation[n]||h.push(n),h.join("")},callbacks:function(n){var f=u.val(),o=f!==e;if(!0===o&&"function"==typeof r.onChange)r.onChange(f,n,t,r);if(!0===o&&"function"==typeof r.onKeyPress)r.onKeyPress(f,n,t,r);if("function"==typeof r.onComplete&&f.length===i.length)r.onComplete(f,n,t,r)}};f.remove=function(){var n;u.destroyEvents();u.val(f.getCleanVal()).removeAttr("maxlength");n=u.getCaret();u.setCaret(n-u.getMCharsBeforeCount(n))};f.getCleanVal=function(){return u.getMasked(!0)};f.init=function(){r=r||{};f.byPassKeys=[9,16,17,18,36,37,38,39,40,91];f.translation={0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}};f.translation=n.extend({},f.translation,r.translation);f=n.extend(!0,{},f,r);o=u.getRegexMask();!1!==r.maxlength&&t.attr("maxlength",i.length);r.placeholder&&t.attr("placeholder",r.placeholder);t.attr("autocomplete","off");u.destroyEvents();u.events();var e=u.getCaret();u.val(u.getMasked());u.setCaret(e+u.getMCharsBeforeCount(e,!0))}()},t={},i=function(){var t=n(this),i={};t.attr("data-mask-reverse")&&(i.reverse=!0);"false"===t.attr("data-mask-maxlength")&&(i.maxlength=!1);t.attr("data-mask-clearifnotmatch")&&(i.clearIfNotMatch=!0);t.mask(t.attr("data-mask"),i)};n.fn.mask=function(i,u){var f=this.selector,e=function(t){if(!t.originalEvent||n(t.originalEvent.relatedNode)[0]!=n(this)[0])return n(this).data("mask",new r(this,i,u))};this.each(e);f&&!t[f]&&(t[f]=!0,setTimeout(function(){n(document).on("DOMNodeInserted.mask",f,e)},500))};n.fn.unmask=function(){try{return this.each(function(){n(this).data("mask").remove()})}catch(t){}};n.fn.cleanVal=function(){return this.data("mask").getCleanVal()};n("*[data-mask]").each(i);n(document).on("DOMNodeInserted.mask","*[data-mask]",i)});